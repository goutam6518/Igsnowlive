<!DOCTYPE html>
<html>
<head>
  <title>Game Download</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: Arial, sans-serif; font-size:40xp; text-align: center; padding: 20px; background-color: #000; color: #ffc107; }
    img { width: 530px; border-radius: 10px; margin-bottom: 20px; }
    .btn { background: #ffc107; color: #000; height: 15%; width: 40%; padding: 12px 25px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
    .info { margin-top: 5px; font-size: 40px; }
    .bottom-nav { position: fixed; bottom: 0; height: 2%; width: 100%; display: flex; justify-content: space-around; padding: 10px 0; background: #ffc107; border-top: 1px solid #ccc; }
    .bottom-nav button { font-size: 25px; background: none; border: none; }
    #error, #gameSection { display: none; }
  </style>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCRtPZ34Y1J-p5b7FJxEUagYg3h_D6PbhM",
    authDomain: "igsfogstudio-df541.firebaseapp.com",
    databaseURL: "https://igsfogstudio-df541-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "igsfogstudio-df541",
    storageBucket: "igsfogstudio-df541.firebasestorage.app",
    messagingSenderId: "206722625476",
    appId: "1:206722625476:web:c222830b5404f87bf57e91",
    measurementId: "G-1JL82Z0FK0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const gameId = params.get("id");

    async function loadGame() {
      const loader = document.getElementById("loading");
      const gameSection = document.getElementById("gameSection");
      const errorDiv = document.getElementById("error");

      if (!gameId) {
        loader.style.display = "none";
        errorDiv.textContent = "No game ID provided.";
        errorDiv.style.display = "block";
        return;
      }

      try {
        const docRef = doc(db, "games", gameId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const game = docSnap.data();
          document.getElementById("logo").src = game.gameLogoUrl;
          document.getElementById("name").textContent = game.gameName;
          document.getElementById("uploader").textContent = `Uploader: ${game.uploaderName}`;
          document.getElementById("downloadBtn").onclick = () => window.location.href = game.downloadLink;
          document.getElementById("downloads").textContent = `Downloads: ${game.downloadsCount || 0}`;
          document.getElementById("fileSize").textContent = `File Size: ${game.fileSize || "Unknown"}`;

          loader.style.display = "none";
          gameSection.style.display = "block";
        } else {
          loader.style.display = "none";
          errorDiv.textContent = "Game not found.";
          errorDiv.style.display = "block";
        }
      } catch (e) {
        loader.style.display = "none";
        errorDiv.textContent = "Error loading game: " + e.message;
        errorDiv.style.display = "block";
      }
    }

    window.onload = loadGame;
  </script>
</head>
<body>

  <div id="loading"><h3>Loading game...</h3></div>

  <div id="gameSection">
    <img id="logo" src="" alt="Game Logo">
    <h1 id="name"></h1>
    <h3 id="uploader"></h3>
    <button id="downloadBtn" class="btn">Download</button>
    <div class="info" id="downloads"></div>
    <div class="info" id="fileSize"></div>
  </div>

  <div id="error" style="color:red; margin-top:20px;"></div>

  <div class="bottom-nav">
    <button onclick="location.href='index.html'">Home</button>
    <button onclick="location.href='profile.html'">Profile</button>
  </div>

</body>
</html>
